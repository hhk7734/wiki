---
id: repository
title: Repository
sidebar_label: Repository
description: Repository
keywords:
  - ddd
  - repository
---

## 애그리거트당 하나의 레포지토리

- https://learn.microsoft.com/en-us/dotnet/architecture/microservices/microservice-ddd-cqrs-patterns/infrastructure-persistence-layer-design

<br />

- 레포지토리는 데이터베이스를 업데이트하는 데 사용해야하는 유일한 방법이어야 합니다
- 애그리거트 루트가 불변성과 트랜잭션 일관성을 관리하기 때문에 애그리거트 루트와 레포지토리는 1:1 관계여야 합니다
- 쿼리는 데이터베이스의 상태를 변경하지 않기 때문에 다른 방법으로 처리해도 됩니다(CQRS)

## CQRS

- Command Query Responsibility Segregation
- CRUD를 `CUD`와 `R`로 분리하는 것입니다
- CRUD와 관련된 모든 기능을 `CQRS`로 분리하는 것은 불필요한 작업일 수 있습니다
- `CQRS`의 필요성을 느끼는 흔한 사례는 무거운 애그리거트의 목록을 표시하기 위한 작업이 있을 때 입니다
  - 어떤 기능을 수행할 수 있는 Project라는 애그리거트가 있을 때, 사용자에게 Project를 선택할 수 있도록 목록을 표시해야하는 상황을 가정해보겠습니다
  - Project를 선택하기 위해 사용자는 ProjectID, Name, UpdatedAt 정도만 필요할 수도 있습니다
  - 하지만 레포지토리만 사용한다면 리스트를 만들기위해 완전한 Project 애그리거트 리스트를 가져와야합니다
  - 이런 경우 쿼리를 필요한 부분만 가져오도록 하는 것이 성능상 이점이 있기 때문에 Project에 한해 CQRS를 적용하는 것이 좋을 수 있습니다
