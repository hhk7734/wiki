---
id: gin
title: Gin
sidebar_label: Gin
description: Gin
keywords:
  - gin
---

## 설치

- https://github.com/gin-gonic/gin
- https://github.com/cosmtrek/air

```shell
go get -u github.com/gin-gonic/gin
```

```shell
go install github.com/cosmtrek/air@latest
```

```shell
air init
```

## Config

- https://github.com/caarlos0/env
- https://github.com/joho/godotenv

```shell
go get -u github.com/caarlos0/env/v6
```

```shell
go get -u github.com/joho/godotenv
```

```shell title=".env"
DEBUG=true
PORT=8080
K8S_POD_NAME=gin-test
K8S_POD_NAMESPACE=localhost
```

```go title="internal/config/config.go
package config

import (
	"fmt"

	"github.com/caarlos0/env/v6"
	"github.com/joho/godotenv"
)

type config struct {
	Debug bool      `env:"DEBUG" envDefault:"false"`
	Port  int       `env:"PORT" envDefault:"8080"`
	K8s   k8sConfig `envPrefix:"K8S_"`
}

type k8sConfig struct {
	PodName      string `env:"POD_NAME,required"`
	PodNamespace string `env:"POD_NAMESPACE,required"`
}

var c config

func Init() {
	var err error
	err = godotenv.Load()
	if err != nil {
		fmt.Println("failed to load .env", err)
	}

	err = env.Parse(&c)
	if err != nil {
		fmt.Println("failed to parse env", err)
	}
}

func Config() config {
	return c
}
```

## Dockerfile

```shell title=".dockerignore"
.env
```

```dockerfile title="Dockerfile"
FROM golang:1.19.2-alpine AS build
WORKDIR /app

COPY . /app
RUN go mod tidy
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -ldflags '-s' -tags=go_json,nomsgpack -buildvcs=false -o app


FROM alpine:3.16.3 AS runtime
WORKDIR /app

COPY --from=build /app/app /usr/bin/

ENV PORT 8080
EXPOSE 8080
CMD ["app"]
```

```dockerfile title="Dockerfile"
FROM golang:1.19.2-alpine AS build
WORKDIR /app

COPY . /app
RUN apk --update add ca-certificates
RUN go mod tidy
RUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -a -ldflags '-s' -tags=go_json,nomsgpack -buildvcs=false -o app


FROM scratch AS runtime
WORKDIR /app

COPY --from=build /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ca-certificates.crt
COPY --from=build /app/app /usr/bin/

ENV PORT 8080
EXPOSE 8080
CMD ["app"]
```

scratch 이미지를 사용하면 작은 이미지를 만들 수 있지만, 디버깅이 어려울 수 있습니다.
