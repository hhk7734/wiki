---
id: crd
title: NATS CRD
sidebar_label: CRD
description: NATS CRD
keywords:
  - nats
  - crd
---

## Stream

```shell
kubectl explain streams.spec
```

```yaml
apiVersion: jetstream.nats.io/v1beta2
kind: Stream
metadata:
  name: <resource-name>
  namespace: event
spec:
  name: <stream-name>
  subjects: # 이 Stream이 consume하는 subjects
    - <subject>

  storage: file # memory | file
  maxAge: "240h" # 00h00m00s | "", 메시지 최대 보관 기간
  replicas: 3 # 1, 3, 5 ... 로 설정

  retention: limits # limits | interest | workqueue
  discard: old # old | new, 제한된 값을 넘었을 때 삭제 순서
  maxBytes: -1 # 최대 저장 용량
  maxMsgs: -1 # 최대 저장 메시지 수
  maxMsgSize: -1 # 메시지 하나의 최대 크기
```

:::info
Stream, Consumer, Account의 name은 파일 경로로 사용되기 때문에 `[a-z0-9]*` 32자 이하로 만드는 것이 좋습니다. 버전 업데이트에 따라 이 제약사항이 사라질 수 있다고 합니다.
:::

## Consumer

```shell
kubectl explain consumer.spec
```

### Push

```yaml
apiVersion: jetstream.nats.io/v1beta2
kind: Consumer
metadata:
  name: <resource-name>
  namespace: event
spec:
  durableName: <consumer-name> # 서버가 Consumer가 어디까지 소비했는지 확인하기 위한 이름
  streamName: <stream-name>
  filterSubject: <subject>
  deliverPolicy: all # all | last | new | byStartSequence | byStartTime
  # optStartSeq: 0
  # optStartTime: "2022-07-05T01:32:00+09:00"

  maxDeliver: 20 # Ack 정책으로 인해 재전송 될 때, 최대 재시도 횟수
  ackPolicy: explicit
  ackWait: 30s
  maxAckPending: 1000 # Ack 정책을 사용할 때, Ack를 받지 못한 메시지 수가 이 값을 넘어가면 일시 중지 됨
  rateLimitBps: -1

  # deliverPolicy에 따라 이전 메시지부터 메시지를 replay할 때
  # 원래 메시지를 받은 속도로 할지 아니면 가능한 빠른 속도로 할지 결정
  replayPolicy: instant # instant | original
```

### Pull

```yaml

```
