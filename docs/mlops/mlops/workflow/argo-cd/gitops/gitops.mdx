---
id: gitops
title: Argo CD GitOps
sidebar_label: GitOps
description: Argo CD GitOps
keywords:
  - argo
  - cd
  - gitops
---

import Image from '@theme/IdealImage';

## GitOps

<center>
	<Image
		img={require('@site/static/img/mlops/mlops/event/argo-cd/argo-cd-gitops.png')}
		width={600}
	/>
</center>
<center>https://nortal.com/blog/gitops-argocd/</center>
<br />

GitHub, GitHub Action, ECR, Argo-CD, Helm Chart를 이용한 GitOps 설정에 대한 예시입니다.

## GitOps Repository

```shell
project/
├── .helmignore
├── cd/
│   └── dev-values.yaml
├── Chart.yaml
├── templates/
│   ├── _helpers.tpl
│   ├── backend/
│   │   └── ...
│   └── frontend/
│       ├── _helpers.tpl
│       ├── deployments.yaml
│       ├── horizontalpodautoscaler.yaml
│       ├── service.yaml
│       └── serviceaccount.yaml
└── values.yaml
```

```yaml title="project/values.yaml"
nameOverride: ''
namespaceOverride: ''
fullnameOverride: ''

commonLabels: {}

frontend:
  image:
    repository: '<ecr>/frontend'
    tag: ''
    pullPolicy: IfNotPresent

  podLabels: {}

  resources: {}

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 10
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 80

backend:
  image:
    repository: '<ecr>/backend'
    tag: ''
    pullPolicy: IfNotPresent
# ...
```

```yaml title= "project/templates/_helpers.tpl
{{- define "project.name" -}}
{{- default .Chart.Name .Values.nameOverride | trunc 63 | trimSuffix "-" }}
{{- end }}

{{- define "project.namespace" -}}
{{- default .Release.Namespace .Values.namespaceOverride | trunc 63 | trimSuffix "-" }}
{{- end }}

{{- define "project.fullname" -}}
{{- if .Values.fullnameOverride }}
{{- .Values.fullnameOverride | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- $name := (include "project.name" . ) }}
{{- if contains $name .Release.Name }}
{{- .Release.Name | trunc 63 | trimSuffix "-" }}
{{- else }}
{{- printf "%s-%s" .Release.Name $name | trunc 63 | trimSuffix "-" }}
{{- end }}
{{- end }}
{{- end }}

{{- define "project.chart" -}}
{{- printf "%s-%s" .Chart.Name .Chart.Version | replace "+" "_" | trunc 63 | trimSuffix "-" }}
{{- end }}

{{- define "project.labels" -}}
{{- range $name, $value := .Values.commonLabels -}}
{{ $name }}: {{ tpl $value $ }}
{{ end -}}
helm.sh/chart: {{ include "project.chart" . }}
app.kubernetes.io/part-of: {{ include "project.name" . }}
app.kubernetes.io/managed-by: {{ .Release.Service }}
app.kubernetes.io/created-by: "hhk7734@gmail.com"
{{- end }}
```

```yaml title="project/templates/frontend/_helpers.tpl"
{{- define "project.frontend.fullname" -}}
{{ include "project.fullname" . }}-frontend
{{- end }}

{{- define "project.frontend.matchLabels" -}}
app.kubernetes.io/name: {{ include "project.frontend.fullname" . }}
app: {{ include "project.frontend.fullname" . }}
{{- end }}

{{- define "project.frontend.labels" }}
{{- include "project.labels" . }}
{{ include "project.frontend.matchLabels" . }}
{{- end }}
```

## GitHub Action for CD

아래 예시는 프로젝트 중 프론트 엔드 dev용 CD Action 파일입니다.

- https://github.com/hhk7734/wiki.loliot.net/blob/main/.github/workflows/cd.yaml
