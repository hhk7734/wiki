---
id: affinity
title: Affinity
sidebar_label: Affinity
description: node/pod affinity/anti-affinity
keywords:
  - kubernetes
  - affinity
  - anti-affinity
---

## nodeAffinity & nodeAntiAffinity

Pod가 스케줄링될 때 Node의 label을 기준으로 Pod을 스케줄링하거나 하지 않습니다.

```yaml
spec:
  affinity:
    nodeAffinity:
      # 필수적으로 만족해야하는 규칙입니다
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          # 여러개 선언하면 OR 조건이 적용됩니다
          - matchExpressions:
              # 여러개 선언하면 AND 조건이 적용됩니다
              - key: <labelKey>
                operator: In # In, NotIn, Exists, DoesNotExist, Gt, Lt
                values:
                  - <labelValue>
      # 선호하는 노드에 대한 규칙입니다
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1 # 1 ~ 100, 만족하는 조건의 weight의 총합이 높은 노드를 선호합니다
          preference:
            matchExpressions:
              - key: <labelKey>
                operator: In # In, NotIn, Exists, DoesNotExist, Gt, Lt
                values:
                  - <labelValue>
```

## podAffinity & podAntiAffinity

Pod가 스케줄링될 때 다른 Pod의 label을 기준으로 Pod을 찾고, 해당 Pod이 위치한 topologyKey를 확인 후 같은 topologyKey, 같은 값을 갖는 Node에 Pod을 스케줄링하거나 하지 않습니다

```yaml
spec:
  affinity:
    podAffinity:
      # 필수적으로 만족해야하는 규칙입니다
      requiredDuringSchedulingIgnoredDuringExecution:
        - labelSelector:
            matchExpressions:
              - key: <labelKey>
                operator: In # In, NotIn, Exists, DoesNotExist
                values:
                  - <labelValue>
          # 노드의 label key를 지정합니다
          # kubernetes.io/hostname
          # topology.kubernetes.io/zone
          # topology.kubernetes.io/region
          topologyKey: <labelKey> # 노드의 label key를 지정합니다
          # 생략하면 해당 Pod의 namespace를 사용합니다
          namespaces:
            - <namespace>
      # 선호하는 노드에 대한 규칙입니다
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 1 # 1 ~ 100, 만족하는 조건의 weight의 총합이 높은 노드를 선호합니다
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: <labelKey>
                  operator: In # In, NotIn, Exists, DoesNotExist
                  values:
                    - <labelValue>
            topologyKey: <labelKey> # 노드의 label key를 지정합니다
```
