---
id: nats
title: NATS
sidebar_label: NATS
description: NATS
keywords:
  - nats
---

## 설치

```shell
helm repo add nats https://nats-io.github.io/k8s/helm/charts
```

### NATS

- [PersistentVolume](/docs/mlops/mlops/kubernetes/persistent-volume)

```shell
helm repo update nats \
&& helm search repo nats/nats -l | head -n 10
```

```shell
helm show values nats/nats \
    --version 0.19.5 \
    > nats-values.yaml
```

```yaml title="nats-values.yaml"
fullnameOverride: ""

commonLabels: {}

nats:
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      memory: 256Mi

  limits:
    maxPayload: 1MB # 최댓값: 64MB, 권장 최댓값: 8MB

  jetstream:
    enabled: true

    memStorage:
      enabled: false
      size: 1Gi

    fileStorage:
      enabled: true
      storageDirectory: /data
      size: 10Gi
      accessModes:
        - ReadWriteOnce

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - podAffinityTerm:
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: nats
              app.kubernetes.io/instance: nats
          topologyKey: kubernetes.io/hostname
        weight: 100

statefulSetPodLabels: {}

cluster:
  enabled: true
  replicas: 3

natsbox:
  enabled: false

auth:
  enabled: true

  basic:
    users:
      - user: <user>
        password: <password>
      - nkey: <nkey-user>
```

```shell
helm template nats nats/nats \
    --version 0.19.5 \
    -n event \
    -f nats-values.yaml \
    > nats.yaml
```

```shell
helm upgrade nats nats/ntas \
    --install \
    --version 0.19.5 \
    -n event \
    --history-max 3 \
    -f nats-values.yaml
```

### NACK

```shell
kubectl apply -f https://github.com/nats-io/nack/releases/download/v0.10.1/crds.yml
```

```shell
helm repo update nats \
&& helm search repo nats/nack -l | head -n 10
```

```shell
helm show values nats/nack \
    --version 0.21.0 \
    > nack-values.yaml
```

```yaml title="nack-values.yaml"
resources:
  requests:
    cpu: 10m
    memory: 64Mi
  limits:
    memory: 64Mi
```

```shell
helm template nack nats/nack \
    --version 0.21.0 \
    -n event \
    -f nack-values.yaml \
    > nack.yaml
```

```shell
helm upgrade nack nats/nack \
    --install \
    --history-max 3 \
    --version 0.21.0 \
    -n event \
    -f nack-values.yaml
```

## Test

```shell
kubectl run -i --rm --tty nats-box --image=natsio/nats-box --restart=Never
```
