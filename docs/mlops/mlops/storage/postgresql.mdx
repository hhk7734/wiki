---
id: postgresql
title: postgresql
sidebar_label: postgresql
description: postgresql
keywords:
  - postgresql
---

## Installation

```yaml
apiVersion: v1
kind: Secret
metadata:
  name: <secret-name>
  namespace: storage
type: Opaque
stringData:
  postgres-password: <password>
```

:::info
사용할 `StorageClass`의 `allowVolumeExpansion`가 `true`인 지 확인 후 진행해주세요.
:::

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: <pvc-name>
  namespace: storage
spec:
  storageClassName: <storage-class>
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
```

```shell
helm repo add bitnami https://charts.bitnami.com/bitnami
```

```shell
helm repo update bitnami \
&& helm search repo bitnami/postgresql -l | head -n 10
```

```shell
helm show values bitnami/postgresql \
    --version 11.9.13 \
    > postgresql-values.yaml
```

```yaml
primary:
  persistence:
    existingClaim: <pvc-name>
auth:
  enablePostgresUser: true
    existingSecret: <secret-name>
```

```shell
helm template postgresql bitnami/postgresql \
    --version 11.9.13 \
    -n storage \
    --history-max 3 \
    -f postgresql-values.yaml \
    > postgresql.yaml
```

```shell
helm upgrade postgresql bitnami/postgresql \
    --install \
    --version 11.9.13 \
    -n storage \
    --history-max 3 \
    -f postgresql-values.yaml
```

## Test

```shell
kubectl run tmp-psql --rm -it --image postgres -- psql -h postgresql.storage -U postgres -W
```
