---
id: ansible
title: Ansible 기본 안내
sidebar_label: Ansible 기본 안내
description: Ansible 기본 안내
keywords:
  - Ansible
---

## 설치

```shell
python3 -m pip install ansible
```

## Control node

- [SSH 키 생성 후 Managed node에 키 추가](/docs/lang/etc/command-line-tools/ssh)

## Directory structure

- https://docs.ansible.com/ansible/2.8/user_guide/playbooks_best_practices.html#alternative-directory-layout

```shell
<playbook>/
├── ansible.cfg # 설정 파일
├── inventories/
│   ├── <inventory>/
│   │   ├── hosts.yaml
│   │   ├── group_vars/
│   │   │   ├── <group>/
│   │   │   │   ├── <vars>.yaml
│   │   │   │   └── ...
│   │   │   ├── <group>.yaml
│   │   │   └── ...
│   │   └──  host_vars/
│   │       ├── <host>/
│   │       │   ├── <vars>.yaml
│   │       │   └── ...
│   │       ├── <host>.yaml
│   │       └── ...
│   └── ...
├── group_vars/
│   └── ...
├── host_vars/
│   └── ...
├── library/ # 커스텀 모듈
├── module_utils/ # 커스텀 모듈 유틸
├── filter_plugins/ # 커스텀 필터 플러그인
├── <purpose>.yaml # playbook
├── ...
└── roles/
    └── ...
```

## Inventory

- [Inventory](/docs/mlops/mlops/ansible/inventory)

## Playbook

```yaml title="example.yaml"
- hosts: all
  gather_facts: false
  tasks:
    - name: "example"
      command: "echo hello"
```

## Playbook 실행

```shell
ansible-playbook <playbook>
```

- `-i|--inventory <dir|yaml>`
- `-l|--limit '<pattern>'`: 선택된 hosts에 추가적인 제한을 설정합니다.
  - `<pattern>`
    - https://docs.ansible.com/ansible/latest/inventory_guide/intro_patterns.html
    - `<host>`
    - `<group>`
    - `<group>[i]`, `<group>[i:j]`: Python 규칙과 같습니다.
    - `*` glob를 허용합니다
    - `A:B`: B에 있을 수도 있습니다.
    - `A:&B`: B에는 있어야 합니다.
    - `A:!B`: B에는 없어야 합니다.
- `--list-hosts`: 사용자가 설정한 옵션에 따라 실행될 play와 해당 host를 출력합니다.(실행은 되지 않습니다.)
- `--list-tags`: 사용자가 설정한 옵션에 따라 실행될 play와 해당 tags를 출력합니다.(실행은 되지 않습니다.)
- `--list-tasks`: 사용자가 설정한 옵션에 따라 실행될 play와 해당 tasks를 출력합니다.(실행은 되지 않습니다.)
- `ansible -i inventory -m debug -a "var=hostvars[inventory_hostname]" '<pattern>'`: 해당 host들의 변수를 출력합니다.
- 연결 옵션
  - `-u|--user <user>`: 원격 접속 시 사용될 사용자를 설정합니다.
    - `None`이 기본값이고, 이 경우 명령을 실행시키는 쉘의 사용자가 사용됩니다.
  - `-k|--ask-pass`: 원격 접속 시 사용될 비밀번호를 물어보도록 설정합니다.
- 작업 권한 옵션
  - `-b|--become`: `<becomeMethod>`로 작업을 실행시키도록 설정합니다.
  - `--become-user <becomeUser>`: become 사용자를 변경합니다.
    - `root`가 기본값입니다.
  - `-K|--ask-become-pass`: become 사용자의 비밀번호를 물어보도록 설정합니다.
  - `--become-method <becomeMethod>`: 권한 상승 방법을 설정합니다.
    - `sudo`가 기본값입니다.
    - `ansible-doc -t become -l` 명령어로 가능한 값들을 확인할 수 있습니다.
