---
id: cni
title: Container Network Interface(CNI)
sidebar_label: CNI
description: Container Network Interface(CNI)
keywords:
  - Container Network Interface
---

import useBaseUrl from "@docusaurus/useBaseUrl";

## Kubernetes network

Kubernetes network 기본 요구 사항

- 노드의 파드는 NAT 없이 모든 노드의 모든 파드와 통신할 수 있다.
- 노드의 에이전트(예: 시스템 데몬, kubelet)는 해당 노드의 모든 파드와 통신할 수 있다.
- 노드의 호스트 네트워크에 있는 파드는 NAT 없이 모든 노드에 있는 모든 파드와 통신할 수 있다.

### Pod

Docker 의 host 방식으로 pod 내의 컨테이너간 네트워크를 공유합니다. `Pause`라는 container가 생성되며 이 컨테이너가 IPC, Network namespace를 생성하고 유지합니다.

## CNI

- https://github.com/containernetworking/cni/blob/main/SPEC.md

<br />

- Network configuration format
  - `cniVersion`, `cniVersions`, `name`, `disableCheck`, `plugins` 등을 포함한 JSON 객체로 구성됩니다.
- Execution Protocol
  - 플러그인은 실행파일이어야 합니다.
  - 플러그인은 환경 변수와 stdin을 통해 설정값을 받습니다.
  - 플러그인은 설정 성공 시 stdout, 실패 시 stderr로 결과를 반환합니다.
- Execution of Network Configurations
  - 컨테이너 런타임은 네트워크 설정을 해석하여 CNI 플러그인을 실행합니다.
  - 수명 주기
    - 컨테이너 런타임은 플러그인을 호출하기 전에 컨테이너에 대한 새 네트워크 네임스페이스를 생성해야 합니다.
    - ...
    - 컨테이너 런타임은 컨테이너의 네트워크 네임스페이스 정리를 담당합니다.
- Plugin Delegation
  - CNI 플러그인은 일부 기능을 다른 플러그인에 위임할 수 있습니다.(ex) IPAM plugin)
  - 위임받은 플러그인은 실행파일이어야 합니다.
  - 위임받은 플러그인은 CNI 플러그인에 전달된 것과 동일한 환경 변수와 stdin을 모두 설정값으로 받아야합니다.
  - 위임받은 플러그인은 설정 성공 시 stdout, 실패 시 stderr로 결과를 반환합니다.
- Result Types
  - CNI 플러그인의 실행 결과에 대한 JSON 형식의 스키마가 있습니다.

## Example(Calico)

<center>
	<img src={useBaseUrl("img/mlops/mlops/mlops-calico-cni-with-calico-ipam.png")} />
	<br />
	<strong>Calico CNI and Calico IPAM(pod-network-cidr=10.130.0.0/16)</strong>
	<br />
	https://www.youtube.com/watch?v=JyLtg_SJ1lo
</center>
